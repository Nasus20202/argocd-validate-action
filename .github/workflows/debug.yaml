name: Debug Action

on:
  workflow_dispatch:
    inputs:
      repository:
        description: "Repository to test against (owner/repo)"
        required: false
        default: "Nasus20202/infra"
        type: string
      ref:
        description: "Branch, tag, or commit SHA to checkout"
        required: false
        default: "main"
        type: string
      manifests_dir:
        description: "Directory to output generated manifests"
        required: false
        default: "manifests"
        type: string
      apps_dir:
        description: "Directory containing ArgoCD application manifests"
        required: false
        default: "kubernetes/oci/compute/cluster/argocd-apps"
        type: string
      base_path:
        description: "Base path for resolving relative paths in ArgoCD apps"
        required: false
        default: "kubernetes/oci/compute/cluster"
        type: string
      skip_files:
        description: "Comma-separated list of files to skip"
        required: false
        default: ""
        type: string
      skip_resources:
        description: "Comma-separated list of Kubernetes resources to skip during validation"
        required: false
        default: "CustomResourceDefinition,Alloy,Plan,HelmChartConfig"
        type: string
jobs:
  debug:
    name: Debug ArgoCD Build Manifests Action
    runs-on: ubuntu-latest

    steps:
      - name: Checkout test repository
        uses: actions/checkout@v5
        with:
          repository: ${{ inputs.repository }}
          ref: ${{ inputs.ref }}

      - name: Checkout repository
        uses: actions/checkout@v5
        with:
          path: argocd-validate-action

      - name: Debug Action
        uses: ./argocd-validate-action
        with:
          manifests-dir: ${{ inputs.manifests_dir }}
          apps-dir: ${{ inputs.apps_dir }}
          base-path: ${{ inputs.base_path }}
          skip-files: ${{ inputs.skip_files }}
          skip-resources: ${{ inputs.skip_resources }}
